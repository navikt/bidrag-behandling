ALTER TABLE BEHANDLING_BARN
    DROP COLUMN FRA_DATO,
    DROP COLUMN TIL_DATO,
    DROP COLUMN BO_STATUS,
    DROP COLUMN KILDE;

CREATE TABLE BEHANDLING_BARN_PERIODE (
    ID                      INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (INCREMENT 1 START 1 MINVALUE 1),
    BEHANDLING_BARN_ID      INT NOT NULL,
    FRA_DATO                DATE,
    TIL_DATO                DATE,
    BO_STATUS               BO_STATUS_TYPE,
    KILDE                   TEXT,
    CONSTRAINT FK_BEHANDLING_BARN_ID FOREIGN KEY (BEHANDLING_BARN_ID)
    REFERENCES BEHANDLING (ID) MATCH SIMPLE
);

CREATE TYPE SIVILSTAND_TYPE AS ENUM
(
    'ENKE_ELLER_ENKEMANN',
    'GIFT',
    'GJENLEVENDE_PARTNER',
    'REGISTRERT_PARTNER',
    'SEPARERT',
    'SEPARERT_PARTNER',
    'SKILT',
    'SKILT_PARTNER',
    'UGIFT',
    'UOPPGITT'
);

CREATE CAST (VARCHAR AS SIVILSTAND_TYPE) WITH INOUT AS IMPLICIT;

CREATE TABLE SIVILSTAND (
    ID                      INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (INCREMENT 1 START 1 MINVALUE 1),
    BEHANDLING_ID           INT NOT NULL,

    GYLDIG_FRA_OG_MED       DATE,
    BEKREFTELSESDATO        DATE,
    SIVILSTAND_TYPE         SIVILSTAND_TYPE,

    CONSTRAINT FK_BEHANDLING_ID FOREIGN KEY (BEHANDLING_ID)
    REFERENCES BEHANDLING (ID) MATCH SIMPLE
);