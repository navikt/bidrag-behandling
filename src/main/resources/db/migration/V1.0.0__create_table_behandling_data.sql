CREATE TYPE BEHANDLING_TYPE AS ENUM ('FORSKUDD');
CREATE CAST (VARCHAR AS BEHANDLING_TYPE) WITH INOUT AS IMPLICIT;

CREATE TYPE SOKNAD_TYPE AS ENUM
(
    'ENDRING',
    'EGET_TILTAK',
    'SOKNAD',
    'INNKREVET_GRUNNLAG',
    'INDEKSREGULERING',
    'KLAGE_BEGR_SATS',
    'KLAGE',
    'FOLGER_KLAGE',
    'KORRIGERING',
    'KONVERTERING',
    'OPPHOR',
    'PRIVAT_AVTALE',
    'BEGR_REVURD',
    'REVURDERING',
    'KONVERTERT',
    'MANEDLIG_PALOP'
);

CREATE CAST (VARCHAR AS SOKNAD_TYPE) WITH INOUT AS IMPLICIT;

CREATE TYPE FORSKUDD_BEREGNING_KODE_AARSAK_TYPE AS ENUM
(
    'SF',
    'NF',
    'OF',
    'AF',
    'CF',
    'DF',
    'LF',
    'GF',
    'HF',
    'BF',
    'KF',
    'QF',
    'MF',
    'PF',
    'EF',
    'FF'
);

CREATE CAST (VARCHAR AS FORSKUDD_BEREGNING_KODE_AARSAK_TYPE) WITH INOUT AS IMPLICIT;

CREATE TYPE ROLLE_TYPE AS ENUM
(
    'BIDRAGS_PLIKTIG',
    'BIDRAGS_MOTTAKER',
    'BARN',
    'REELL_MOTTAKER'
);

CREATE CAST (VARCHAR AS ROLLE_TYPE) WITH INOUT AS IMPLICIT;

CREATE TABLE IF NOT EXISTS ROLLE
(
    ID              int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (INCREMENT 1 START 1 MINVALUE 1),
    IDENT           VARCHAR(20),
    OPPRETTET_DATO  DATE,
    ROLLE_TYPE      ROLLE_TYPE,
    NAVN            TEXT
);

CREATE TABLE IF NOT EXISTS BEHANDLING
(
    ID                              INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (INCREMENT 1 START 1 MINVALUE 1),
    BEHANDLING_TYPE                 BEHANDLING_TYPE,
    SOKNAD_TYPE                     SOKNAD_TYPE,
    SOKT_FRA_ID                     INT NOT NULL,
    VIRKNINGS_DATO                  DATE,
    AARSAK                          FORSKUDD_BEREGNING_KODE_AARSAK_TYPE DEFAULT NULL,
    AVSLAG                          TEXT DEFAULT NULL,
    BEGRUNNELSE_MED_I_VEDTAK_NOTAT  TEXT DEFAULT NULL,
    BEGRUNNELSE_KUN_I_NOTAT         TEXT DEFAULT NULL,
    DATO_FOM                        DATE,
    DATO_TOM                        DATE,
    SAKSNUMMER                      VARCHAR(7),
    BEHANDLER_ENHET                 CHAR(4),

    CONSTRAINT FK_SOKT_FRA_ID FOREIGN KEY (SOKT_FRA_ID)
        REFERENCES ROLLE (ID) MATCH SIMPLE
);
